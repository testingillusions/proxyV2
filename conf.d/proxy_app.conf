server {
    listen       80 default_server;
    server_name  ec2-44-200-40-252.compute-1.amazonaws.com;

    location /app/modules/tba/ {
        # —————— 1) Preflight OPTIONS ——————
        if ($request_method = OPTIONS) {
            add_header 'Access-Control-Allow-Origin'  '*'                always;
            add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
            add_header 'Access-Control-Allow-Headers' 'Authorization,Content-Type' always;
            add_header 'Access-Control-Max-Age'       3600               always;
            return 204;
        }

        # —————— 2) Proxy the real request ——————
        proxy_pass       http://tba.uglyyellowbunny.com:80$request_uri;
        proxy_set_header Host              tba.uglyyellowbunny.com;
        proxy_set_header X-Real-IP         $remote_addr;
        proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # —————— 3) Add CORS on the real GET/POST ——————
        add_header 'Access-Control-Allow-Origin'  '*'                always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' 'Authorization,Content-Type' always;
    }
    location /assets/ {
        # —————— 1) Preflight OPTIONS ——————
        if ($request_method = OPTIONS) {
            add_header 'Access-Control-Allow-Origin'  '*'                always;
            add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
            add_header 'Access-Control-Allow-Headers' 'Authorization,Content-Type' always;
            add_header 'Access-Control-Max-Age'       3600               always;
            return 204;
        }

        # —————— 2) Proxy the real request ——————
        proxy_pass       http://tba.uglyyellowbunny.com:80$request_uri;
        proxy_set_header Host              tba.uglyyellowbunny.com;
        proxy_set_header X-Real-IP         $remote_addr;
        proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # —————— 3) Add CORS on the real GET/POST ——————
        add_header 'Access-Control-Allow-Origin'  '*'                always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' 'Authorization,Content-Type' always;
    }
}